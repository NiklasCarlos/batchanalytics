---
title: "R Notebook"
output: html_notebook
---


```{r setup}

library(batchanalytics)
library(bupaR)
library(bamalog)

```

Load sample eventlog 


```{r}

csv = system.file("exdata", "sample_data_1.csv", package = "batchanalytics")

csv_log = read.csv(csv)

task_log <- csv_log


```


detect batching behaviour and create a task log

```{r}


# Create seq_tolerated_gap_list (gap of 0 seconds is allowed)
seq_tolerated_gap_list <- seq_tolerated_gap_list_generator(task_log = task_log, 
                                                           seq_tolerated_gap_value = 0)

subsequence_list <- enumerate_subsequences(task_log, 0)
# Use the following line for using frequent sequence mining instead
# subsequence_list <- identify_frequent_sequences(task_log, 0)

# Detect batching behavior
result_log <- detect_batching(task_log = task_log,
                             act_seq_tolerated_gap_list = seq_tolerated_gap_list,
                             timestamp_format = "yyyy-mm-dd hh:mm:ss",
                             numeric_timestamps = FALSE,
                             log_and_model_based = TRUE,
                             subsequence_list = subsequence_list,
                             subsequence_type = "enum",
                             # use `mine` to use frequence sequence mining
                             # subsequence_type = "mine",
                             within_case_seq_tolerated_gap = 0,
                             between_cases_seq_tolerated_gap = 0,
                             show_progress = F)
```



```{r}
head(result_log)
```


###batch processing metrics


```{r}

#evtl chunk löschen aber vorher auschecken
# ausserdem metric test implementation example xes rmd testen unterer part bupaR testen

##############################
#Batch Processing metrics
##############################

class(result_log)

as.data.frame(result_log)

#das komma xx[,] hat gefehlt
result_log[result_log$batch_number == "481",]

#result_log %>% throughput_time(units = "hours")


#https://www.bupar.net/subsetting.html#processing_time
#https://github.com/ctreffe/r-space/wiki/datenzugriff

#log % filter(nur batch) % process_time_ process_map(zeige die durchlaufzeiten mit und ohne batch)

#erstelle event log nach mit wunschergebniss-> für bathch orienteieren an anderen event logs - BEDINGUNG FÜR BATCH NACHSCHAUEN

```


```{r}
#test batch frequency


metric_frequency(result_log, "Registration", "B", "concurrent", FALSE )
```



```{r}

#test batch size
#metric_frequency(result_log, "Registration", "r1", "concurrent", FALSE )

metric_batch_size(result_log, "B", "WorkerB_#0", "concurrent", exclude_singletons = TRUE)

```



```{r}
# Metric - Activity duration
metric_activity_duration(result_log, "B", "WorkerB_#0", "concurrent")



```



